@page "/devices"
@inject NavigationManager navManager;
@inject IContentService<Device> deviceService;

<DeviceList Devices="devices" DeleteCurrentDevice="RequestDeletion" UpdateCurrentDevice="UpdateDevice"></DeviceList>

<Confirmation @ref="deleteConfirmation" OnConfirmed="@DeleteDevice"></Confirmation>

@code {
    private List<Device> devices;
    private Confirmation deleteConfirmation;

    protected override async Task OnInitializedAsync()
    {
        devices = (await deviceService.GetAll()).ToList();

        await base.OnInitializedAsync();
    }

    private async Task RequestDeletion(Device device)
    {
        deleteConfirmation.HeaderContent = $"Deleting device";
        deleteConfirmation.BodyContent = $"Are you sure you want to delete device named {device.Name} with id {device.Id}?\n" +
                                          "This action can not be undone.";
        deleteConfirmation.actionItem = device;
        deleteConfirmation.Show();
    }

    private async Task DeleteDevice(Object o)
    {
        Device device = (Device)o;
        int result = deviceService.Remove(device).Result;
        if(result==0){
            devices = (deviceService.GetAll()).Result.ToList();
        }    
    }

    private void UpdateDevice(int id)
    {
        navManager.NavigateTo($"./update-device/{id}");
    }
}
